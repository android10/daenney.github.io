<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>puppetlabs-apt/next</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://daenney.github.io/themes/Casper/favicon.ico">

    <link rel="stylesheet" type="text/css" href="https://daenney.github.io/themes/Casper/assets/css/screen.css?v=1.0.0" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="https://daenney.github.io/2015/03/05/puppetlabs-aptnext.html" />
    
    <meta property="og:site_name" content="Daenney" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="puppetlabs-apt/next" />
    <meta property="og:description" content="As some of you know I&amp;#8217;m the unofficial maintainer of the apt module from Puppetlabs. Together with Morgan Haskel from the Puppetlabs Module Team we try and keep that module up to date and in good shape. The..." />
    <meta property="og:url" content="https://daenney.github.io/2015/03/05/puppetlabs-aptnext.html" />
    <meta property="article:published_time" content="2015-03-04T23:00:00.000Z" />
    <meta property="article:modified_time" content="2015-03-05T16:11:58.223Z" />
    <meta property="article:tag" content="puppet" />
    <meta property="article:tag" content="puppetlabs" />
    <meta property="article:tag" content="apt" />
    <meta property="article:tag" content="puppetlabs-apt" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="puppetlabs-apt/next" />
    <meta name="twitter:description" content="As some of you know I&amp;#8217;m the unofficial maintainer of the apt module from Puppetlabs. Together with Morgan Haskel from the Puppetlabs Module Team we try and keep that module up to date and in good shape. The..." />
    <meta name="twitter:url" content="https://daenney.github.io/2015/03/05/puppetlabs-aptnext.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Daenney",
    "author": {
        "@type": "Person",
        "name": "Daniele Sluijters",
        "image": "https://avatars.githubusercontent.com/u/569574?v=3",
        "url": "undefined/author/undefined",
        "sameAs": ""
    },
    "headline": "puppetlabs-apt/next",
    "url": "https://daenney.github.io/2015/03/05/puppetlabs-aptnext.html",
    "datePublished": "2015-03-04T23:00:00.000Z",
    "dateModified": "2015-03-05T16:11:58.223Z",
    "keywords": "puppet,  puppetlabs,  apt,  puppetlabs-apt",
    "description": "As some of you know I&amp;#8217;m the unofficial maintainer of the apt module from Puppetlabs. Together with Morgan Haskel from the Puppetlabs Module Team we try and keep that module up to date and in good shape. The..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Daenney" href="https://daenney.github.io/rss" />
</head>
<body class="post-template tag-undefined tag-undefined tag-undefined tag-undefined">

    


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="https://daenney.github.io">Home</a>
        <!-- <a class="subscribe-button icon-feed" href="https://daenney.github.io/rss/">Subscribe</a> -->
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-undefined tag-undefined tag-undefined tag-undefined">

        <header class="post-header">
            <h1 class="post-title">puppetlabs-apt/next</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2015-03-05">05 March 2015</time>  on <a href="https://daenney.github.io/tag/puppet">puppet</a>, <a href="https://daenney.github.io/tag/ puppetlabs"> puppetlabs</a>, <a href="https://daenney.github.io/tag/ apt"> apt</a>, <a href="https://daenney.github.io/tag/ puppetlabs-apt"> puppetlabs-apt</a>
            </section>
        </header>

        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As some of you know I&#8217;m the unofficial maintainer of the <a href="https://github.com/puppetlabs/puppetlabs-apt/">apt module</a> from Puppetlabs. Together with <a href="https://github.com/mhaskel">Morgan Haskel</a> from the Puppetlabs Module Team we try and keep that module up to date and in good shape.</p>
</div>
<div class="paragraph">
<p>The apt module has not seen a significant revision since its inception in 2010. Over the past 4 years it has accumulated feature after feature without anyone taking a hard looking at what was going on inside. We merged features that in hindsight have no business being in the apt module and added switches on the main class for all kinds of bizarre things.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_needs_to_go">What needs to go</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What we decided was that we need to reduce the apt module back to its core. The purpose of the apt module is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To manage configuration entries in <code>/etc/apt/conf.d</code></p>
</li>
<li>
<p>To manage repository entries in <code>/etc/apt/sources.list.d</code></p>
</li>
<li>
<p>To manage GPG keys for package validation through <code>apt-key</code></p>
</li>
<li>
<p>To manage apt preferences in <code>/etc/apt/preferences.d</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The apt module should provide these basic building blocks to allow you to configured apt as you need. It should not be a collection of user-specific preferences on how apt is to be configured.</p>
</div>
<div class="paragraph">
<p>We identified a few things that we were unhappy with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unattended-upgrades: Even though it stores configuration in <code>/etc/apt/conf.d</code> it has no business being part of the apt module itself. Maybe people want to use cron-apt instead, or another way of doing this. We should however provide types that allow people to easily and correctly write those configuration files from an external module.</p>
</li>
<li>
<p>fancy progress: For some reason I merged a change that allowed you to configure apt fancy progress through a switch on the main class. This is stupid. If anything user interaction should be limited with the system, we&#8217;re automating things, so fancy progress seems completely out of place. However, we never had a good way for users to be able to write those settings, safe for coming up with a <code>file</code> resource definition yourself.</p>
</li>
<li>
<p>builddep: A way to install the build dependencies of a package. This can now be solved by the <code>install_options</code> on the <code>package</code> type and can therefor be removed.</p>
</li>
<li>
<p>Wrapper classes like <code>backports</code> or <code>releases</code>: The only thing they do is create an <code>apt::source</code> entry. It seems harmless but then it starts. "I need to configure a pin", "I need the pin to be configured at a different priority", "I need the pin to be pinned on release and not on origin" and so on. We get pull request after pull request for mostly user-specific features. These things are very easily managed yourself but currently cause unnecessary churn in the module. It&#8217;s time for them to go.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_needs_to_be_added">What needs to be added</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;re removing quite a few things but in return we&#8217;re introducing some of the building blocks that will help you easily recreate the old behaviour.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apt::setting</code>: A new defined type to write configuration entries for apt. Based on the prefix of the resource name <code>conf-</code>, <code>pref-</code> or <code>list-</code> it will write the file to either <code>/etc/apt/conf.d</code>, <code>/etc/apt/preferences.d</code> or <code>/etc/apt/sources.list.d</code>. You&#8217;ll almost never need an <code>apt::setting { 'list-somerepo': }</code> but it&#8217;s used internally by <code>apt::source</code> and any other place we write configuration. It supports things as <code>priority</code>, passing in a <code>source</code> or <code>content</code> and knows to notify the <code>apt_update</code> <code>exec</code>.</p>
</li>
<li>
<p><code>sources</code>, <code>keys</code>, <code>settings</code> and <code>ppas</code> on the main class. Every of those options expects a hash of resources and leverages <code>create_resources()</code> to create resource entries in the catalog. This means you can now fully drive all apt configuration changes from a data binding backend like Hiera.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_things_that_have_remained_but_changed">Things that have remained but changed</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Major spring cleaning in <code>apt::ppa</code>.</p>
</li>
<li>
<p>Overall spring cleaning and bringing the module in line with our current best practices of module design.</p>
</li>
<li>
<p>Raise our dependencies. We&#8217;ve been stuck with stdlib 2.x and old Puppet versions for too long.</p>
</li>
<li>
<p>The <code>purge_*</code> options and their defaults have changed. We now accept a <code>purge</code> hash with four keys, <code>sources.list</code>, <code>sources.list.d</code>, <code>preferences</code> and <code>preferences.d</code>. They all default to <code>true</code> now too. You can pass a partial hash to <code>purge</code>. Instead of needing to specify all entries if you want to override only one of the purge entries, only pass in a hash of the entries you want to override and we&#8217;ll take care to merge the rest in there.</p>
</li>
<li>
<p>The <code>key</code> option on <code>apt::source</code> can now take a hash allowing you to pass additional parameters through to the underlying <code>apt::key</code> and <code>apt_key</code> that ends up getting called.</p>
</li>
<li>
<p>The <code>update_*</code> options have been consolidated into a single hash with the same behaviour as the <code>purge</code> hash.</p>
</li>
<li>
<p>The <code>proxy_*</code> options have been consolidated into a single hash with the same behaviour as the <code>purge</code> and <code>update</code> hash. Additionally those proxy options are now also used by <code>apt::ppa</code> and you can turn the option to proxy HTTPS requests on or off. It defaults to off.</p>
</li>
<li>
<p>We&#8217;ve removed a set of prefixes on <code>apt::key</code> and <code>apt_key</code>. Things that were named along the lines of <code>key_server</code> are now simply called <code>server</code> as the prefix was redundant.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_status">Status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;re not done, yet. Most of the things I&#8217;ve described here are reflected on the <a href="https://github.com/puppetlabs/puppetlabs-apt/tree/next">next branch</a>. We&#8217;re also hard at work to getting the documetation back into order, write the necessary examples and provide a migration guide for when we release 2.0.0.</p>
</div>
<div class="paragraph">
<p>We also have plans to release a 3.0.0 version once Puppet 4 has seen some uptake leveraging the new Type system to do parameter validation and other features. This release will likely not break antyhing on the API level of apt, we&#8217;ll just require newer features in Puppet itself.</p>
</div>
<div class="paragraph">
<p>Working with <a href="https://twitter.com/knittynerd">Morgan</a> on this has been a very rewarding experience. We had some excellent discussions about what we were doing and managed to go through most of the changes at break-neck speed. Except when Travis-CI decided not to run tests because yolo. We&#8217;re in a good place and this experience will hopefully set a precedent for many more collaborations to come.</p>
</div>
</div>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="" style="background-image: url(https://avatars.githubusercontent.com/u/569574?v=3)"><span class="hidden">Daniele Sluijters's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="">Daniele Sluijters</a></h4>

                    <p>Read <a href="">more posts</a> by this author.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Stockholm</span>
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=puppetlabs-apt%2Fnext&amp;url=https://daenney.github.io/2015/03/05/puppetlabs-aptnext.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://daenney.github.io/2015/03/05/puppetlabs-aptnext.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://daenney.github.io/2015/03/05/puppetlabs-aptnext.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="https://daenney.github.io">Daenney</a> &copy; 2015</section>
        <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script>

    <script type="text/javascript" src="https://daenney.github.io/themes/Casper/assets/js/jquery.fitvids.js?v=1.0.0"></script>
    <script type="text/javascript" src="https://daenney.github.io/themes/Casper/assets/js/index.js?v=1.0.0"></script>

</body>
</html>
